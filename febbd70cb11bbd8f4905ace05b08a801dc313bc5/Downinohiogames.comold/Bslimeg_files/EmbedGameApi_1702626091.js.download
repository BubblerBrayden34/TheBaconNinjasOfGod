function EmbedGameApi(e){var c=this;var f=this;this.App=e;this.enableDebug=true;this._init=false;this._xdmAvailable=false;this._connected=false;this._rpc=false;var b=false;var a=false;var d=function(h,g){var j=false;try{j=new XMLHttpRequest()}catch(i){}if(j&&"withCredentials" in j){j.open(h,g,true)}else{if(typeof XDomainRequest!="undefined"){j=new XDomainRequest();j.open(h,g);j.onload=function(){this.readyState=4;if(this.onreadystatechange instanceof Function){this.onreadystatechange()}}}else{if(j){j.open(h,g,true)}}}return j};this.initRPCIframe=function(j,g,i,h){if(typeof h!="function"){h=function(){}}f._rpc=new easyXDM.Rpc({remote:j,swf:c.App.url.api_lechuck_static+"js/easyxdm/easyxdm.swf",container:g,props:i,onLoad:h,onReady:function(){if(c.App.game.view_type=="fullscreen"){c.App.game.navigation.fullscreen.showFrame()}f._rpc.hello({env_is_internal:true,env_locale:c.App.i18n.locale_name,env_is_scalable:c.App.game.navigation.player.isScalable(),env_is_resizable:c.App.game.navigation.player.isResizable(),env_is_maximized:c.App.game.navigation.player.isMaximized(),env_view_type:c.App.game.navigation.player.getViewType(),env_current_view_type:c.App.game.navigation.player.getCurrentViewType(),env_size:c.App.game.navigation.player.getSize(),env_current_size:c.App.game.navigation.player.getCurrentSize(),env_parent:document.location.href,user_id:c.App.user.id},function(k){})}},{remote:{hello:{},die:{},resize:{},buyItemsBlocked:{},buyItemsCallback:{},getCallback:{},shareCallback:{}},local:{get:function(l,k){var m=d("GET",k);if(m){m.onreadystatechange=function(){if(m.readyState==4){f._rpc.getCallback(l,m.responseText)}};m.send(null);return true}return false},login:function(l){var k=null;if(MP.game.is_embed){k=parent.MP.user.showLogin()}else{k=c.App.user.showLogin()}if(c.App.user.isAlive()){if(c.App.game.is_devel){alert("USER LOG-IN:\n\nYou're already logged in, so, the page will be reloaded.\n\nRegular users will see our 'please log in' dialog, after they finish the process, the page will be reloaded.")
}document.location.href=c.removeURLParam(document.location.href,"guest");return false}if(l instanceof Function){l(k)}},register:function(l){var k=null;if(MP.game.is_embed){k=parent.MP.user.showRegister()}else{k=c.App.user.showRegister()}if(c.App.user.isAlive()){if(c.App.game.is_devel){alert("USER REGISTRATION:\n\nYou're already logged in, so, the page will be reloaded.\n\nRegular users will see our 'registration' dialog, after they finish the process, the page will be reloaded.")}document.location.href=c.removeURLParam(document.location.href,"guest");return false}if(l instanceof Function){l(k)}},openBuyItems:function(n,m,l,k){if(b){clearTimeout(b)}c.openBuyItems(n+"&int=1")},toComments:function(){c.App.game.navigation.toComments()},toSimilarGames:function(){c.App.game.navigation.toSimilarGames()},toHighscoreGlobal:function(l,k){c.App.game.navigation.toHighscoreGlobal(l,k)},toHighscoreFriends:function(k){c.App.game.navigation.toHighscoreFriends(k)},toAchievements:function(){c.App.game.navigation.toAchievements()},highlightLikeGame:function(){c.App.game.navigation.highlightLikeGame()},highlightFavGame:function(){c.App.game.navigation.highlightFavGame()},highlightAchievements:function(){c.App.game.navigation.highlightAchievements()},toSagaGames:function(){c.App.game.navigation.toSagaGames()},toCollectionGames:function(){c.App.game.navigation.toCollectionGames()},toUserShare:function(l,k){c.App.game.navigation.toUserShare(l,k,function(m,n){f._rpc.shareCallback(m,n)})},toUserChallenge:function(n,l,m,k){c.App.game.navigation.toUserChallenge(n,l,m,k,function(o,p){f._rpc.shareCallback(o,p)})},maximize:function(){c.App.game.navigation.player.maximize()},minimize:function(){c.App.game.navigation.player.minimize()},getCurrentSize:function(k){if(k instanceof Function){k(c.App.game.navigation.player.getCurrentSize())}},getSize:function(k){if(k instanceof Function){k(c.App.game.navigation.player.getSize())}},getViewType:function(k){if(k instanceof Function){k(c.App.game.navigation.player.getViewType())
}},getCurrentViewType:function(k){if(k instanceof Function){k(c.App.game.navigation.player.getCurrentViewType())}},isMaximized:function(k){if(k instanceof Function){k(c.App.game.navigation.player.isMaximized())}},isScalable:function(k){if(k instanceof Function){k()}},setSize:function(l,k){if(typeof l=="undefined"){return false}if(typeof k=="undefined"){return false}c.App.game.navigation.player.customSize.set(l,k)},resetSize:function(){c.App.game.navigation.player.customSize.reset()},setViewportScale:function(k){if(typeof k=="undefined"){return false}c.App.game.navigation.player.setViewportScale(k)},hideOverlay:function(){},showOverlay:function(){},debug:function(k){c.debug(k)},error:function(k){c.error(k)},onApiAuthenticate:function(k){if(k!=c.App.user.id){f._rpc.die()}}}});this.initEvents()};this.initEvents=function(){c.App.user.registerEventListener("die",function(){f._rpc.die()});c.App.game.registerEventListener("player_resize",function(){f._rpc.resize({env_view_type:c.App.game.navigation.player.getViewType(),env_current_view_type:c.App.game.navigation.player.getCurrentViewType(),env_is_scalable:c.App.game.navigation.player.isScalable(),env_is_resizable:c.App.game.navigation.player.isResizable(),env_is_maximized:c.App.game.navigation.player.isMaximized(),env_size:c.App.game.navigation.player.getSize(),env_current_size:c.App.game.navigation.player.getCurrentSize(),env_parent:document.location.href})})};this.openBuyItems=function(g){if(typeof g!="undefined"){buyItemsUrl=g}if(!buyItemsUrl){return}if(MP.game.is_embed){parent.MP.navigation.modals.modalFrame.showModal(buyItemsUrl,function(){c.buyItemsCallback(false)})}else{MP.navigation.modals.modalFrame.showModal(buyItemsUrl,function(){c.buyItemsCallback(false)})}};this.buyItemsCallback=function(g){f._rpc.buyItemsCallback(g);b=setTimeout(function(){c.App.navigation.modals.modalFrame.closeModal(null,true)},3000)};this.removeURLParam=function(g,m){var k=g.split("?");if(k.length>=2){var l=encodeURIComponent(m)+"=";var j=k[1].split(/[&;]/g);
for(var h=j.length;h-->0;){if(j[h].indexOf(l,0)==0){j.splice(h,1)}}if(j.length>0){return k[0]+"?"+j.join("&")}else{return k[0]}}else{return g}};this.debug=function(g){if(!c.enableDebug){return false}if(typeof console!="object"||!"log" in console){return false}if(typeof g=="string"){console.log(g)}else{if(typeof g=="boolean"){console.log(g?"true":"false")}else{console.log(g)}}};this.error=function(g){if(typeof console!="object"||!"error" in console){return false}if(typeof g=="string"){console.error(g)}else{if(typeof g=="boolean"){console.error(g?"true":"false")}else{console.error(g)}}};this.init=function(){if(typeof easyXDM!="object"){c.error("easyXDM is not available, unable to initialize API communications");return false}if(typeof JSON!="object"){c.error("JSON is not available, unable to initialize API communications");return false}c._xdmAvailable=true;this._init=true};this.init()};